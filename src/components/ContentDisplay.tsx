"use client";

import { useEffect, useState } from "react";
import "./ContentDisplay.css";

interface ContentDisplayProps {
  sectionId: string;
  subsectionId?: string;
  onSearch?: (term: string) => void;
  searchTerm?: string;
}

interface Poem {
  id: string;
  title: string;
  author: string;
  content: string;
}

export default function ContentDisplay({
  sectionId,
  subsectionId,
  onSearch,
  searchTerm,
}: ContentDisplayProps) {
  const [content, setContent] = useState<string>("");
  const [poems, setPoems] = useState<Poem[]>([]);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    setLoading(true);
    loadContent();
  }, [sectionId, subsectionId]);

  const loadContent = async () => {
    try {
      try {
        const response = await fetch("api/poems");
        const data: Poem[] = await response.json();
        setPoems(data);
      } catch (apiError) {
        console.warn("API not available, using fallback content");
      }

      // Generate content based on section and subsection
      const generatedContent = generateContent(sectionId, subsectionId);
      setContent(generatedContent);
    } catch (error) {
      console.error("Failed to load content:", error);
      setContent(`
        <div class="error-section">
          <h2 style="color: #d32f2f;">рддреНрд░реБрдЯрд┐</h2>
          <p style="color: #666;">рд╕рд╛рдордЧреНрд░реА рд▓реЛрдб рдирд╣реАрдВ рд╣реЛ рд╕рдХреАред рдХреГрдкрдпрд╛ рдкреБрдирдГ рдкреНрд░рдпрд╛рд╕ рдХрд░реЗрдВред</p>
        </div>
      `);
    } finally {
      setLoading(false);
    }
  };

  const generateContent = (
    section: string,
    subsection?: string
  ): string => {
    if (section === "author") {
      return `
        <div class="author-section">
          <h1>рд▓реЗрдЦрдХ рдкрд░рд┐рдЪрдп</h1>
          <h2>рдЬрдЧрджреАрд╢ рдЧреЛрдХрд▓рд╛рдиреА "рдЬрдЧ рдЧреНрд╡рд╛рд▓рд┐рдпрд░реА"</h2>
          <p>
            рдЬрдЧрджреАрд╢ рдЧреЛрдХрд▓рд╛рдиреА, рдЬрд┐рдиреНрд╣реЗрдВ "рдЬрдЧ рдЧреНрд╡рд╛рд▓рд┐рдпрд░реА" рдХреЗ рдирд╛рдо рд╕реЗ рдЬрд╛рдирд╛ рдЬрд╛рддрд╛ рд╣реИ, рдПрдХ рдкреНрд░рд╕рд┐рджреНрдз рд╣рд┐рдВрджреА рдХрд╡рд┐ рдФрд░ рд▓реЗрдЦрдХ рд╣реИрдВред
            рдЙрдирдХреА рд░рдЪрдирд╛рдПрдБ рд╡рд┐рднрд┐рдиреНрди рд╡рд┐рдзрд╛рдУрдВ рдореЗрдВ рд╕рдореГрджреНрдз рд╣реИрдВ, рдЬрд┐рдирдореЗрдВ рджреЛрд╣реЗ, рдЧреАрдд, рдЧрд╝рдЬрд╝рд▓ рдФрд░ рдЕрдиреНрдп рдЫрдВрдж рд╢рд╛рдорд┐рд▓ рд╣реИрдВред
          </p>
          <p>
            рдЙрдирдХреА рд╕рд╛рд╣рд┐рддреНрдпрд┐рдХ рдпрд╛рддреНрд░рд╛ рдореМрд▓рд┐рдХ рдФрд░ рд╕реНрд╡рд░рдЪрд┐рдд рдХрд╡рд┐рддрд╛рдУрдВ рд╕реЗ рднрд░реА рд╣реИ, рдЬреЛ рднрд╛рд░рддреАрдп рд╕рдВрд╕реНрдХреГрддрд┐, рдзрд░реНрдо рдФрд░ рдЬреАрд╡рди рдореВрд▓реНрдпреЛрдВ рдХреЛ 
            рджрд░реНрд╢рд╛рддреА рд╣реИред рд╡реЗ рд╣рд┐рдВрджреА рднрд╛рд╖рд╛ рдФрд░ рдЫрдВрдж рд╢рд╛рд╕реНрддреНрд░ рдХреЗ рдкреНрд░рддрд┐ рд╕рдорд░реНрдкрд┐рдд рд╣реИрдВред
          </p>
          <div class="poetry-info">
            <h3>рдкреНрд░рдореБрдЦ рд╡рд┐рд╢реЗрд╖рддрд╛рдПрдБ:</h3>
            <ul>
              <li>рджреЛрд╣рд╛рд╡рд▓реА рдХреЗ рд╡рд┐рд╡рд┐рдз рд╡рд┐рд╖рдп</li>
              <li>рд╡рд┐рднрд┐рдиреНрди рдЫрдВрдж рд╡рд┐рдзрд╛рдУрдВ рдореЗрдВ рджрдХреНрд╖рддрд╛</li>
              <li>рдЖрдзреНрдпрд╛рддреНрдорд┐рдХ рдФрд░ рд╕рд╛рдорд╛рдЬрд┐рдХ рдЪреЗрддрдирд╛</li>
              <li>рд╣рд┐рдВрджреА рд╕рд╛рд╣рд┐рддреНрдп рдХреЛ рд╕рдореГрджреНрдз рдХрд░рдиреЗ рдХрд╛ рдпреЛрдЧрджрд╛рди</li>
            </ul>
          </div>
        </div>
      `;
    }

    if (section === "kavita") {
      return `
        <div class="kavita-section">
          <h1>рдХрд╡рд┐рддрд╛</h1>
          <p>рдЬрдЧ рдЧреНрд╡рд╛рд▓рд┐рдпрд░реА рдХреА рдХрд╡рд┐рддрд╛рдУрдВ рдХрд╛ рд╡рд┐рд╢рд╛рд▓ рд╕рдВрдЧреНрд░рд╣ рдпрд╣рд╛рдБ рдЙрдкрд▓рдмреНрдз рд╣реИред</p>
          <p>рдЗрд╕ рд╡рд░реНрдЧ рдореЗрдВ рд╕рднреА рдкреНрд░рдХрд╛рд░ рдХреА рдореВрд▓ рдХрд╡рд┐рддрд╛рдПрдБ рд╢рд╛рдорд┐рд▓ рд╣реИрдВред</p>
        </div>
      `;
    }

    if (section === "dohawali") {
      if (subsection === "doha") {
        return getDohaContent();
      }
      return `
        <div class="dohawali-section">
          <h1>рджреЛрд╣рд╛рд╡рд▓реА</h1>
          <p>рджреЛрд╣рд╛рд╡рд▓реА рд╣рд┐рдВрджреА рд╕рд╛рд╣рд┐рддреНрдп рдХрд╛ рд╕рдмрд╕реЗ рдкреНрд░рдЪрд▓рд┐рдд рдФрд░ рд╕рд░рд▓ рдЫрдВрдж рд╣реИред</p>
          <p>рдХреГрдкрдпрд╛ рдмрд╛рдИрдВ рдУрд░ рд╕реЗ рдХрд┐рд╕реА рд╡рд┐рд╖рдп рдХрд╛ рдЪрдпрди рдХрд░реЗрдВред</p>
        </div>
      `;
    }

    if (section === "geet") {
      return `
        <div class="geet-section">
          <h1>рдЧреАрдд</h1>
          <p>рд╡рд┐рднрд┐рдиреНрди рдЫрдВрдж рд╡рд┐рдзрд╛рдУрдВ рдореЗрдВ рд░рдЪрд┐рдд рдЧреАрдд рдпрд╣рд╛рдБ рдкреНрд░рд╕реНрддреБрдд рд╣реИрдВред</p>
          <p>рдХреГрдкрдпрд╛ рдмрд╛рдИрдВ рдУрд░ рд╕реЗ рдХрд┐рд╕реА рдЫрдВрдж рдХрд╛ рдЪрдпрди рдХрд░реЗрдВред</p>
        </div>
      `;
    }

    if (section === "ghazal") {
      return `
        <div class="ghazal-section">
          <h1>рдЧрд╝рдЬрд╝рд▓</h1>
          <p>рдЧрд╝рдЬрд╝рд▓ рдЙрд░реНрджреВ рдФрд░ рдлрд╝рд╛рд░рд╕реА рдХрд╛рд╡реНрдп рдХреА рдПрдХ рдкрд╛рд░рдВрдкрд░рд┐рдХ рд╡рд┐рдзрд╛ рд╣реИред</p>
          <p>рд╡рд┐рднрд┐рдиреНрди рдмрд╣рд░реЛрдВ рдореЗрдВ рд░рдЪрд┐рдд рдЧрд╝рдЬрд╝рд▓реЗрдВ рдпрд╣рд╛рдБ рдЙрдкрд▓рдмреНрдз рд╣реИрдВред</p>
        </div>
      `;
    }

    return `<div class="default-section"><p>рдХреГрдкрдпрд╛ рдмрд╛рдИрдВ рдУрд░ рд╕реЗ рдХреЛрдИ рд╡рд┐рд╖рдп рдЪреБрдиреЗрдВред</p></div>`;
  };

  const getDohaContent = (): string => {
    return `
      <div class="doha-content">
        <h1>рджреЛрд╣рд╛ рдкрд░ рджреЛрд╣реЗ</h1>
        <div class="doha-text">
          <p>рдЬрдЧ рд░рдЪрддрд╛ рджреЛрд╣рд╛рд╡рд▓реА, рд▓реЗрдХрд░ рдЧрдгрдкрддрд┐ рдирд╛рдоред<br>рдХрд░реБрдгрд╛ рдХрд╛ рдкреНрд░рднреБ рд╣рд╛рде рдзрд░, рдорд┐рд▓реЗ рд╕рдлрд▓ рдкрд░рд┐рдгрд╛рдоредред</p>
          <p>рдкреНрд░рдердо рдкреВрдЬреНрдп рдЧрдгрд░рд╛рдЬ рдЬреА, рджреЗрдирд╛ рдмреБрджреНрдзрд┐ рдЕрдкрд╛рд░ред<br>рдЕрд░реНрдкрд┐рдд рд╣реИ рджреЛрд╣рд╛рд╡рд▓реА, рдЪрд░рдг рд╢рд░рдг рдордиреБрд╣рд╛рд░ред</p>
          <p>рджреЛрд╣реЗ рдЬрдЧ рдХреЗ рд╣рд┐рдд рд▓рд┐рдЦреВрдБ, рджреЗрдирд╛ рдпрд╣ рд╡рд░рджрд╛рдиред<br>рдмреБрджреНрдзрд┐ рд╡рд┐рдзрд╛рддрд╛ рджреАрдЬрд┐рдП, рдореБрдЭрдХреЛ рдЗрддрдирд╛ рдЬреНрдЮрд╛рдиредред</p>
          <p>рджреЛрд╣рд╛ рд▓рд┐рдЦрдирд╛ рдЕрддрд┐ рд╕рд░рд▓, рдХреЛрд╢рд┐рд╢ рдХрд░ рдХреЗ рджреЗрдЦред<br>рдкреНрд░рддрд┐ рджрд┐рди рдХреЗ рдЕрднреНрдпрд╛рд╕ рд╕реЗ, рд░рдЪ рдЬрд╛рддрд╛ рд╣реИ рд▓реЗрдЦредред</p>
          <p>рджреЛрд╣реЗ рд▓рд┐рдЦрддреЗ рд╣реА рдЪрд▓реЗрдВ, рдмрдврд╝реЗ рдЖрдк рдХреА рд╢рд╛рдиред<br>рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ рдЬрд╛рдирд┐рдП, рдорд╛рддреНрд░рд╛ рдЧрдгрдирд╛ рдЬреНрдЮрд╛рдиред</p>
          <p>рд╕рд░рд▓ рдЫрдВрдж рджреЛрд╣рд╛ рдмрдбрд╝рд╛, рдЪрд░рдг рд░рд╣реЗрдВ рдмрд╕ рдЪрд╛рд░ред<br>рджреЛ рдкрдж рдореЗрдВ рд╣реА рдмрд╛рдБрдз рдХрд╡рд┐, рднрд╛рд╡реЛрдВ рдХрд╛ рд╡рд┐рд╕реНрддрд╛рд░редред</p>
          <p>рд╡рд┐рд╖рдо рдЪрд░рдг рддреЗрд░рд╣ рд░рдЦреЗрдВ, рднрд╛рд╡ рднрд░реЗрдВ рдЕрддрд┐ рдЦрд╛рд╕ред<br>рд░рдЦрд┐рдП рдЧреНрдпрд╛рд░рд╣ рд╕рдо рд╕рджрд╛, рдХрд░рддреЗ рд░рд╣реЗрдВ рдкреНрд░рдпрд╛рд╕редред</p>
          <p>рддреЗрд░рд╣ рдЧреНрдпрд╛рд░рд╣ рднрд╛рд░ рдХрд╛, рд░рдЦрдирд╛ рд╣реЛрдЧрд╛ рдзреНрдпрд╛рдиред<br>рдкреНрд░рдердо рджреГрд╖реНрдЯрд┐ рдореЗрдВ рдЬрд╛рдирд┐рдП, рдпрд╣ рдордЬрдмреВрдд рд╡рд┐рдзрд╛рдиредред</p>
          <p>рдЪрд╛рд░ рдЪрд░рдг рдкрд░ рд╣реИ рдЯрд┐рдХрд╛, рднрд╛рд╡реЛрдВ рдХрд╛ рд╢реБрдЪрд┐ рд╕рд╛рд░ред<br>рдорд╛рддреНрд░рд╛ рдЕрдбрд╝рддрд╛рд▓реАрд╕ рдХреБрд▓, рдЗрд╕рдХреА рдореАрдареА рдзрд╛рд░редред</p>
          <p>рджреЛрд╣реЗ рдХреЗ рдкреНрд░рддрд┐ рдкрдж рд░рдЦреЗрдВ, рднрд╛рд░ рд╕рджрд╛ рдЪреМрдмреАрд╕ред<br>рднрд╛рд░ рдмрд░рд╛рдмрд░ рджреЛ рддрд░рдл, рд░рдЦрдирд╛ рдЫрд╣ рдХрдо рддреАрд╕редред</p>
        </div>
      </div>
    `;
  };

  if (loading) {
    return <div className="content-loading">рд▓реЛрдб рд╣реЛ рд░рд╣рд╛ рд╣реИ...</div>;
  }

  return (
    <div className="content-display">
      {/* Global Search Bar */}
      {onSearch && (
        <div className="search-container">
          <input
            type="text"
            placeholder="ЁЯФН рдХрд╡рд┐рддрд╛рдУрдВ рдореЗрдВ рдЦреЛрдЬреЗрдВ..."
            value={searchTerm || ""}
            onChange={(e) => onSearch(e.target.value)}
            className="search-input"
          />
        </div>
      )}
      <div dangerouslySetInnerHTML={{ __html: content }} />
    </div>
  );
}
